# 红黑树

红黑树是一种二叉查找树，二叉查找树能快速的查找、插入、删除操作。各个操作的时间复杂度都是 log(n)。但是二叉查找树在频繁的更新过程中，可能会出现树的高度远大于 log2n（2为底数）的情况，导致时间复杂度退化，性能降低。极端情况下，会退化成链表，时间复杂度为 O(n)。所以我们要引入一个相对 “平衡” 的树结构，也就是今天要讲的红黑树（Red-Black Tree）。

## 定义

在二叉搜索树的基础上，在每个结点上增加一个存储位来表示结点的颜色，红或是黑。通过对任何一条从根到叶子的简单路径上各个结点的颜色进行约束，**红黑树确保没有一条路径会比其它路径长出 2 倍**。

## 性质

一颗红黑树有以下 5 点特征：

1. 每个结点不是红色就是黑色。
2. 根结点是黑色的。
3. 每个叶子结点（NIL）都是黑色的。
4. 如果一个结点是红色的，那它两个子结点就是黑色的。
5. 对每个结点， 从该结点到其所有后代叶结点的简单路径上，均包含相同数目的黑色结点。

平衡二叉查找树中的 “平衡” 的意思其实就是让整颗树左右看起来比较 “对称”、比较 “平衡”，不要出现左子树（或右子树）很高（矮）的情况，这样树的高度就不会很高，所以相应的查找、插入、删除操作性能不会退化。

## 红黑树的 “平衡”

二叉树很多操作都与树的高度成正比。一颗极其平衡的二叉树（满二叉树或完全二叉树）的高度大约为 lgn，所以如果要证明红黑树的平衡，我们只需要证明它的高度是否趋紧于 lgn。

我们可以用相对简洁的办法粗略的来求证。

**我们首先来把红黑树中的红色结点去掉只剩黑色结点的树**，来看下树的高度是多少？

![](https://static001.geekbang.org/resource/image/7e/ed/7e6ecc308fe44120f30de809822215ed.jpg)

> 注意：红色结点删除之后，有些结点没有父结点，它们会把父结点的父结点作为父结点，所以就成了上图所示（四叉树）

我们根据前面说的红黑树的第五点性质，丛任意结点到可达的叶子结点的简单路径包含的黑色结点数量是相同。

我们从四叉树中取出某些结点，放到叶子结点位置，那么四叉树就变成完全二叉树，所以包含四叉树的高度要比相同结点个数的完全二叉树高度要小。

现在我们知道了只包含黑色结点的 “黑树” 高度，那么我们再把红色结点加回去，高度右会变成多少？

我们根据红色树的第四点特征知道，红色结点肯定不会相邻的。也就是说有一个红色结点就要至少有一个黑色结点，将其它红色结点分开。红黑树包含最多黑色结点的路径最多不会超过 lgn（也就是高度），所以加上红色结点之后，最长路径不会超过 2lgn。

所以红黑树的高度也仅仅比完全二叉树（满二叉树）这种完全平衡的树结构多一倍，在性能上，退化的不明显。

实际上这样推倒出来的结果不精确，实际上红黑树的性能更好。

那么当我们在给这样的红黑树添加或删除数据是，遇到像之前二叉搜索树一样，极端情况下怎么避免退化成链式结构的呢？换句话说就是红黑树如何在频繁的插入与删除操作下还能保持它的 “平衡”。这就是下面紧接着要提到的旋转。

## 旋转

因为在红黑树插入或者删除操作情况下，由于对树结构进行了修改，结果可能有违与之前提到的红黑树的性质，所以我们要为了满足上述五点特征，必须要**改变树中某些结点的颜色以及指针结构**

指针的修改是通过旋转（ratation）来完成的。它能保持红黑色的性质。它又分为左旋和右旋。

### 左旋

### 右旋



