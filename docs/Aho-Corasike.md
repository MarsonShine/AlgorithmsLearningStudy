# AC自动机：用多模式串匹配实现敏感词过滤功能

我们经常在一些社交 app 当中有脏、淫秽、赌毒等词汇，系统检测到了之后会自动实现过滤用 “***” 来代替，实现的方式有很多种，比如正则式匹配等。但是当一个系统用户量非常巨大的时候，如果没有一个高性能的字符串过滤算法来支撑的话，那么当用户发送信息的时候，检测出来在发出来都要好几秒了。

# 基于单模式串和 Trie 树实现的敏感词功能

我们前面有提到很多种字符串匹配算法，有 BF 算法、RK 算法、KMP 算法以及 Trie 树。前四种都是单模式串匹配算法，只有 Trie 树式多模式匹配。

单模式串是，一个模式串和一个主串进行匹配，即在主串中查找一个模式串。

多模式串是，多个模式串和一个主串进行匹配，即在主串中查找多个模式串。

要知道，单模式串也可以完成多模式串匹配，我们可以针对敏感词汇，通过单模式匹配算法（KMP 算法）与用户输入的文字内容进行匹配。但是这样的做的话，每次匹配过程就得重新扫描一次用户输入的内容。特别是当敏感词汇很多的时候，用户输入的内容非常长时比如上千个字符，我们就要需要扫描上千个这样的字符，这样时非常低效的。

这个时候，多模式串匹配就显得比单模式要适合的多。**它只需要扫描一遍用户输入的内容（主串），就能在主串中一次性查找多个模式串是否匹配，这样就大大提高了匹配效率**。我们知道 Trie 树就是一种多模式匹配算法。那么如何用 Trie 树实现过滤呢？

我们可以对敏感词字典进行预处理，构建成 Trie 树结构。这个预处理的操作只需做一次，如果敏感词更新了，例如删除、添加了一个敏感词，我们就动态的更新 Trie 树就可以了。

当用户输入一个文本内容时，我们把用户输入的内容作为主串，从第一个字符（假设是字符 C）开始，在 Trie 树中匹配。当匹配到 Trie 树的叶子结点，或途中遇到不匹配的字符时，我们就将主串的的开始位置后移一位重新在 Trie 树中匹配。