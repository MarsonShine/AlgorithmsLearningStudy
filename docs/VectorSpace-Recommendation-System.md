# 向量空间：实现一个音乐推荐系统

现在很多音乐 APP 都有智能推荐功能，就是根据用户喜欢的音乐，来推荐风格相似的音乐，那么这个功能是如何实现的呢？

## 算法解析

主要有两点：

- 找到与你口味相似的用户，把他们爱听的喜欢的歌推荐给你
- 找出跟你喜欢的歌曲的特征相似的歌曲，然后推荐给你

接下来我们来讨论这两点是如何实现的

## 基于相似用户做推荐

首先要考虑如何找出音乐系统中与你风格相似的人，最能想到的是找到与你喜欢的歌越多的人，我们就说明这个用户的风格跟你的风格是越相似的。解决方案也很简单，我们把 1 作为喜欢，0 作为非喜欢，且看下表

![img](https://static001.geekbang.org/resource/image/cc/06/cc24a9c98a93795c75d8ef7a5892c406.jpg)

通过遍历统计，我们发现小明有 5 首歌与你喜欢的相同，那么就说明小明喜欢的歌曲风格与你是相似的，我们可以设置当你与其他用户喜欢的歌曲相同的个数超过一个设置好的阈值时，系统就判定这位用户喜欢的歌曲风格与你相似，我们就把这位用户喜欢的歌曲中你还没有听过的歌曲推荐给你。

那么现在就又引入一个问题了，系统是如何才能辨别那些歌曲是否是用户喜欢的呢？

我们可以根据用户的行为来判定用户对一首歌的喜爱程度。我们可以为这些行为来给一首歌的喜爱程度打一个分，如下图

![img](https://static001.geekbang.org/resource/image/93/a6/93c26a89303a748199528fdd998ebba6.jpg)

那么还是刚刚的例子，我们把每个行为对应的喜爱程度列出来了。对应到每个用户对歌曲是否喜爱，那么我们就不能用 1 或 0 单纯的表示喜欢与不喜欢了，而是对应一个具体的分值。

![img](https://static001.geekbang.org/resource/image/05/a9/056552502f1cf4fdf331488e0eed5fa9.jpg)

那么有这样的一个数据之后，我们如何判断哪些用户喜欢的歌曲风格与你是相似的呢？

显然我们不能简单的通过歌曲的数量来决定两个用户的之间的相似度了，回想我们在计算字符串之间的相似程度时，有一个距离编辑，其实这里也有这个概念，我们称之为**欧几里得距离（Euclidean distance）**。欧几里得距离是用来计算向量之间的距离的。这里提到了两个概念，向量和距离。

一维空间是一条线，我们用 1，2，3...这样单个的数来表示一维空间的某个位置；二维空间空间一个平面，我们用（1，2），（2，3），（3，4）...这样的二维坐标来表示二维空间的某点位置；同理三维空间表示一个立体空间，用（x，y，z）来表示三维空间的具体位置。这个我们不难理解，那么我们在高维空间的具体某个点如何表示的呢？

假设这里有 K 维空间，我们用类推的方法，我们用（X1，X2，...，Xk）。这种表示方法就是**向量(Vector)**。我们知道，二维，三维，两个位置之间有距离这个概念，类推到多维，也有距离概念。同样根据二三维空间的距离计算，我们类推到 k 维就有

![img](https://static001.geekbang.org/resource/image/f4/12/f4d1d906c076688a43380f82e47dce12.jpg)

这个公式就是欧几里得距离公式。我们把用户喜欢的歌曲程度用向量来表示，我们计算出两个用户之间的欧几里得距离值，越小说明在高维空间中距离越近，风格也就越相似，反之则相反。

![img](https://static001.geekbang.org/resource/image/3e/89/3e145a3054c1abdea5d3f207d13e9b89.jpg)

## 基于相似歌曲做推荐

当系统碰到新用户时，是没有办法采集这个新用户的足够的行为的，所以就无法通过上面的分析方法来推荐相似的歌曲的，那么这种情况，我们如何判断歌曲之间的相似度呢？

最能想到的就是人工通过对歌曲标注一些特征化的标签，比如这首歌的曲风是 hipop，情感是伤感的等。类似基于相似用户做推荐方法一样，每个特征都打一个分数，我们根据分数来计算欧几里得距离。距离越小，说明歌曲越相似。但是这样的话我们就必须人工维护这些歌曲的标签，歌曲是海量的，并且人工维护带有一定的主观意识，推荐起来也不是相对不准确的，这样判断显然是不可行的。所以我们得从另外的角度思考问题。

对于两首歌，如果喜爱的观众是差不多，那从侧面反映出这两歌相似。如图所示，每个用户对歌曲有不同的喜爱程度，我们依旧通过上面的定义得分来定义喜爱程度。

![img](https://static001.geekbang.org/resource/image/a3/ff/a324908e162a60efea4bd7c47c04a6ff.jpg)

我们发现这个图跟上面相似歌曲的图几乎一样，就是歌曲与用户换了位置。基于相似用户的推荐方法中，针对每个用户，我们把歌曲的喜爱程度作为向量，然后算出欧几里得相似距离。有了每个歌曲的向量表示，就可以根据欧几里得距离算出歌曲之间的相似度，然后根据用户听过的歌曲中找到喜爱程度高的歌曲。然后我们找出跟这个歌曲相似很高的歌曲来推荐给用户。

